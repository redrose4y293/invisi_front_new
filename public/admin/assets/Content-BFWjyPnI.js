import{r as h,j as e}from"./index-Damo5oZI.js";import{D as R,I as F,B,u as D,a as T,o as I,s as y,_ as A,c as O}from"./zod-DCjnlhOv.js";import{a as w}from"./api-DhFjHDpY.js";const L=/^[a-z0-9-]+$/,U=I({name:y().min(1,"Name required"),variant:A(["Clear","Pro","Ultra Max","Shadow"]),slug:y().regex(L,"Use a-z 0-9 - only"),status:A(["Draft","Live","Archived"]),images:y().optional()}),M=I({title:y().min(1,"Title required"),section:y().optional(),content:y().min(1,"Content is required"),attachments:y().optional(),slug:y().regex(L,"Use a-z 0-9 - only"),metaTitle:y().max(120).optional(),metaDesc:y().max(160).optional(),status:A(["Draft","Live","Archived"]),isTraining:O().optional(),datetime:y().optional(),mode:A(["Online","On-site"]).optional(),location:y().optional()}),$=[],z=[];function Y(){const[s,f]=h.useState("trainings"),[E,b]=h.useState($),[S,n]=h.useState(z),[u,x]=h.useState(""),[i,k]=h.useState(""),[d,g]=h.useState(null),v=h.useMemo(()=>{let t=[...E];return u&&(t=t.filter(o=>[o.name,o.code,o.slug].some(a=>(a||"").toLowerCase().includes(u.toLowerCase())))),i&&(t=t.filter(o=>o.status===i)),t},[E,u,i]);h.useEffect(()=>{(async()=>{try{const o=new URLSearchParams;u&&o.set("q",u),i&&o.set("status",i);const a=await w.get(`/products${o.toString()?"?"+o.toString():""}`),c=Array.isArray(a==null?void 0:a.items)?a.items:Array.isArray(a)?a:[];if(Array.isArray(c)){const p=c.map(r=>({id:String(r.id??r.slug),name:r.name,code:r.code,variant:r.variant,short:r.short,long:r.long,bullets:r.bullets,nij:r.nij,thickness:r.thickness,vlt:r.vlt,impact:r.impact,images:Array.isArray(r.images)?r.images:[],datasheet:r.datasheet,slug:r.slug,metaTitle:r.metaTitle,metaDesc:r.metaDesc,status:r.status,updated:(r.updatedAt||r.createdAt||new Date().toISOString()).slice(0,10)}));b(p)}}catch{}})()},[u,i]);const C=h.useMemo(()=>{let t=S.filter(o=>{var a;return(((a=o.meta)==null?void 0:a.type)||"")==="training"});return u&&(t=t.filter(o=>[o.title,o.slug].some(a=>(a||"").toLowerCase().includes(u.toLowerCase())))),i&&(t=t.filter(o=>o.status===i)),t},[S,u,i]);h.useEffect(()=>{(async()=>{try{const o=new URLSearchParams;i&&o.set("status",i==="Live"?"published":i==="Draft"?"draft":"");const a=await w.get(`/content/pages${o.toString()?"?"+o.toString():""}`),c=Array.isArray(a==null?void 0:a.items)?a.items:Array.isArray(a)?a:[];if(Array.isArray(c)){const p=c.map(r=>({id:String(r.id??r.slug),title:r.title,slug:r.slug,content:r.body,status:r.status==="published"?"Live":"Draft",meta:r.meta||{},updated:(r.updatedAt||r.createdAt||new Date().toISOString()).slice(0,10)}));n(p)}}catch{}})()},[i]);const l=[{key:"name",header:"Name"},{key:"variant",header:"Variant"},{key:"status",header:"Status"},{key:"updated",header:"Updated"}],m=[{key:"title",header:"Title"},{key:"section",header:"Section"},{key:"status",header:"Status"},{key:"updated",header:"Updated"}],j=e.jsxs("div",{style:{display:"flex",alignItems:"end",justifyContent:"space-between",gap:12,flexWrap:"wrap",padding:12,borderBottom:"1px solid #223",background:"#0E1621"},children:[e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>f("products"),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #334",background:s==="products"?"#1a2633":"#0B1117",color:s==="products"?"#fff":"#E6E6E6"},children:"Products"}),e.jsx("button",{onClick:()=>f("trainings"),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #334",background:s==="trainings"?"#1a2633":"#0B1117",color:s==="trainings"?"#fff":"#E6E6E6"},children:"Trainings"})]}),e.jsx(F,{label:"Search",value:u,onChange:t=>x(t.target.value)}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:12,color:"#C5C6C7"},children:"Status"}),e.jsxs("select",{value:i,onChange:t=>k(t.target.value||""),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{children:"Draft"}),e.jsx("option",{children:"Live"}),e.jsx("option",{children:"Archived"})]})]})]}),e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(B,{onClick:()=>g({type:"product"}),style:{opacity:s==="products"?1:.85,outline:s==="products"?"2px solid var(--accent)":"none"},children:"Add Product"}),e.jsx(B,{onClick:()=>g({type:"page",training:!0}),style:{opacity:s==="trainings"?1:.85,outline:s==="trainings"?"2px solid var(--accent)":"none"},children:"Add Training"})]})})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("h1",{children:"Content"}),e.jsxs("div",{style:{border:"1px solid #223",borderRadius:12,overflow:"hidden",background:"#0E1621"},children:[j,e.jsx("div",{style:{padding:12},children:s==="products"?e.jsx(R,{columns:l,rows:v,density:"compact",onRowClick:t=>g({type:"product",id:t.id})}):e.jsx(R,{columns:m,rows:C,density:"compact",onRowClick:t=>g({type:"page",id:t.id,training:!0})})})]}),(d==null?void 0:d.type)==="product"&&e.jsx(N,{initial:E.find(t=>t.id===d.id),onClose:()=>g(null),onSave:async t=>{const o={...t,images:t.images?t.images.split(",").map(a=>a.trim()).filter(Boolean):[]};if(d!=null&&d.id){b(a=>a.map(c=>c.id===d.id?{...c,...o,updated:new Date().toISOString().slice(0,10)}:c));try{await w.patch(`/products/${d.id}`,{...o})}catch{}}else try{const a=await w.post("/products",{...o}),c={id:String(a.id??a.slug??Date.now()),updated:new Date().toISOString().slice(0,10),...o};b(p=>[c,...p])}catch{alert("Failed to create product")}g(null)}}),(d==null?void 0:d.type)==="page"&&e.jsx(q,{initial:S.find(t=>t.id===d.id),trainingDefault:d==null?void 0:d.training,onClose:()=>g(null),onSave:async t=>{const o=p=>p==="Live"?"published":"draft",a=p=>{if(!p)return;const r=new Date(p);return isNaN(r.getTime())?void 0:r.toISOString()},c=t.isTraining?{type:"training",datetime:a(t.datetime),mode:t.mode||void 0,location:t.location||void 0}:{};if(d!=null&&d.id){n(p=>p.map(r=>r.id===d.id?{...r,...t,meta:c,updated:new Date().toISOString().slice(0,10)}:r));try{await w.patch(`/content/pages/${d.id}`,{title:t.title,slug:t.slug,body:t.content,status:o(t.status),meta:c})}catch{}}else try{const p=await w.post("/content/pages",{title:t.title,slug:t.slug,body:t.content,status:o(t.status),meta:c}),r={id:String(p.id??p.slug??Date.now()),title:t.title,slug:t.slug,content:t.content,status:t.status,updated:new Date().toISOString().slice(0,10),meta:c};n(P=>[r,...P])}catch{alert("Failed to create page")}g(null)}})]})}function N({initial:s,onClose:f,onSave:E}){const{register:b,handleSubmit:S,formState:{errors:n,isSubmitting:u},setValue:x,watch:i}=D({resolver:T(U),defaultValues:{name:(s==null?void 0:s.name)??"",variant:(s==null?void 0:s.variant)??"Clear",slug:(s==null?void 0:s.slug)??"",status:(s==null?void 0:s.status)??"Draft",images:s?(s.images||[]).join(", "):""}}),k=l=>E(l),[d,g]=h.useState((s==null?void 0:s.images)||[]),v=i("images");h.useEffect(()=>{const l=(v||"").split(",").map(m=>m.trim()).filter(Boolean);g(l)},[v]);const C=l=>{if(!l||l.length===0)return;const m=Array.from(l).map(t=>URL.createObjectURL(t)),j=[...d,...m];g(j),x("images",j.join(", "))};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"grid",placeItems:"center",zIndex:60},children:e.jsxs("form",{onSubmit:S(k),style:{background:"#0E1621",border:"1px solid #223",borderRadius:16,width:720,maxWidth:"96vw",padding:18,display:"grid",gap:12,maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{style:{fontSize:16},children:s?"Edit Product":"Create Product"}),e.jsx("button",{type:"button",onClick:f,style:{background:"transparent",border:"1px solid #334",borderRadius:8,color:"#C5C6C7",padding:"6px 10px"},children:"Close"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{gridColumn:"1 / span 2"},children:["Name *",e.jsx("input",{...b("name"),style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid "+(n.name?"#AA2E2E":"#334"),background:"#0B1117",color:"#E6E6E6"}}),n.name&&e.jsx("small",{style:{color:"#FF6B6B"},children:n.name.message})]}),e.jsxs("label",{children:["Variant *",e.jsxs("select",{...b("variant"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:[e.jsx("option",{children:"Clear"}),e.jsx("option",{children:"Pro"}),e.jsx("option",{children:"Ultra Max"}),e.jsx("option",{children:"Shadow"})]})]}),e.jsxs("label",{children:["Slug *",e.jsx("input",{...b("slug"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid "+(n.slug?"#AA2E2E":"#334"),background:"#0B1117",color:"#E6E6E6"}}),n.slug&&e.jsx("small",{style:{color:"#FF6B6B"},children:n.slug.message})]}),e.jsxs("label",{children:["Status *",e.jsxs("select",{...b("status"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:[e.jsx("option",{children:"Draft"}),e.jsx("option",{children:"Live"}),e.jsx("option",{children:"Archived"})]})]}),e.jsxs("div",{style:{gridColumn:"1 / span 2",display:"grid",gap:8},children:[e.jsxs("label",{children:["Upload Images (Optional)",e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:l=>C(l.target.files),style:{marginTop:6}})]}),d.length>0&&e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:d.map((l,m)=>e.jsx("img",{src:l,alt:"preview",style:{width:72,height:72,objectFit:"cover",borderRadius:8,border:"1px solid #223"}},m))})]}),e.jsxs("label",{style:{gridColumn:"1 / span 2"},children:["Image URLs (comma separated) (Optional)",e.jsx("textarea",{rows:3,...b("images"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:f,style:{padding:"8px 12px",border:"1px solid #334",borderRadius:8},children:"Cancel"}),e.jsx("button",{disabled:u,type:"submit",style:{padding:"8px 12px",border:"1px solid #334",borderRadius:8,background:"var(--accent)",color:"#fff"},children:s?"Save":"Create"})]})]})})}function q({initial:s,onClose:f,onSave:E,trainingDefault:b}){var d,g,v,C,l;const S=m=>{if(!m)return"";const j=new Date(m);if(isNaN(j.getTime()))return"";const t=o=>String(o).padStart(2,"0");return`${j.getFullYear()}-${t(j.getMonth()+1)}-${t(j.getDate())}T${t(j.getHours())}:${t(j.getMinutes())}`},{register:n,handleSubmit:u,formState:{errors:x,isSubmitting:i}}=D({resolver:T(M),defaultValues:{title:(s==null?void 0:s.title)??"",slug:(s==null?void 0:s.slug)??"",status:(s==null?void 0:s.status)??"Draft",isTraining:b||(((d=s==null?void 0:s.meta)==null?void 0:d.type)||"")==="training"||!1,datetime:S((g=s==null?void 0:s.meta)==null?void 0:g.datetime)||"",mode:((v=s==null?void 0:s.meta)==null?void 0:v.mode)||void 0,location:((C=s==null?void 0:s.meta)==null?void 0:C.location)||""}}),k=m=>E(m);return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"grid",placeItems:"center",zIndex:60},children:e.jsxs("form",{onSubmit:u(k),style:{background:"#0E1621",border:"1px solid #223",borderRadius:16,width:640,maxWidth:"96vw",padding:18,display:"grid",gap:12,maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{style:{fontSize:16},children:s?"Edit Page":"Create Page"}),e.jsx("button",{type:"button",onClick:f,style:{background:"transparent",border:"1px solid #334",borderRadius:8,color:"#C5C6C7",padding:"6px 10px"},children:"Close"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:[e.jsxs("label",{children:["Title *",e.jsx("input",{...n("title"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid "+(x.title?"#AA2E2E":"#334"),background:"#0B1117",color:"#E6E6E6"}}),x.title&&e.jsx("small",{style:{color:"#FF6B6B"},children:x.title.message})]}),e.jsxs("label",{children:["Slug *",e.jsx("input",{...n("slug"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid "+(x.slug?"#AA2E2E":"#334"),background:"#0B1117",color:"#E6E6E6"}}),x.slug&&e.jsx("small",{style:{color:"#FF6B6B"},children:x.slug.message})]}),e.jsxs("label",{children:["Status *",e.jsxs("select",{...n("status"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:[e.jsx("option",{children:"Draft"}),e.jsx("option",{children:"Live"}),e.jsx("option",{children:"Archived"})]})]}),e.jsxs("label",{children:["Content *",e.jsx("textarea",{rows:6,placeholder:"Description/notes",...n("content"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid "+(x.content?"#AA2E2E":"#334"),background:"#0B1117",color:"#E6E6E6"}}),x.content&&e.jsx("small",{style:{color:"#FF6B6B"},children:((l=x.content)==null?void 0:l.message)||"Content is required"})]}),e.jsxs("div",{style:{marginTop:4,paddingTop:8,borderTop:"1px dashed #244"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",...n("isTraining")})," ",e.jsx("span",{children:"Is Training"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:10,marginTop:8},children:[e.jsxs("label",{children:["Date & Time",e.jsx("input",{type:"datetime-local",step:60,...n("datetime"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"}})]}),e.jsxs("label",{children:["Mode",e.jsxs("select",{...n("mode"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Online"}),e.jsx("option",{children:"On-site"})]})]}),e.jsxs("label",{style:{gridColumn:"1 / -1"},children:["Location",e.jsx("input",{placeholder:"Zoom",...n("location"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"}})]})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:f,style:{padding:"8px 12px",border:"1px solid #334",borderRadius:8},children:"Cancel"}),e.jsx("button",{disabled:i,type:"submit",style:{padding:"8px 12px",border:"1px solid #334",borderRadius:8,background:"var(--accent)",color:"#fff"},children:s?"Save":"Create"})]})]})})}export{Y as default};
