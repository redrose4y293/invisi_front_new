import{r as l,j as e}from"./index-Damo5oZI.js";import{D as M,B as j,I as q,u as T,a as W,o as V,c as Q,s as y}from"./zod-DCjnlhOv.js";import{D as G}from"./Drawer-mjPiPrwt.js";import{S as D}from"./StatusBadge-871Fm8_w.js";import{a as u}from"./api-DhFjHDpY.js";const H=[];function se(){const[d,b]=l.useState(""),[o,f]=l.useState(""),[a,v]=l.useState(""),[x,p]=l.useState(H),[R,F]=l.useState([]),[N,E]=l.useState(!1),[r,S]=l.useState(null),[A,w]=l.useState(""),[L,C]=l.useState(!1),[z,B]=l.useState(null);l.useEffect(()=>{(async()=>{try{const s=new URLSearchParams;d&&s.set("q",d),o&&s.set("status",o),a&&s.set("region",a);const i=await u.get(`/dealers?${s.toString()}`);Array.isArray(i==null?void 0:i.items)&&p(i.items)}catch{}})()},[d,o,a]);const I=l.useMemo(()=>{let t=[...x];if(d){const s=d.toLowerCase();t=t.filter(i=>[i.org,i.contactName,i.contactEmail,i.region].some(c=>c.toLowerCase().includes(s)))}return o&&(t=t.filter(s=>s.status===o)),a&&(t=t.filter(s=>s.region===a)),t},[x,d,o,a]),P=async(t,s)=>{var h,g;const i=Array.isArray(t)?t:[t],c=x;p(n=>n.map(m=>i.includes(m.id)?{...m,status:s}:m)),r&&i.includes(r.id)&&S({...r,status:s});try{await Promise.all(i.map(n=>u.patch(`/dealers/${n}/status`,{status:s}))),s==="Active"&&await Promise.all(i.map(n=>u.post(`/dealers/${n}/approve`)))}catch(n){p(c),alert(((g=(h=n==null?void 0:n.response)==null?void 0:h.data)==null?void 0:g.error)||"Failed to change status")}},k=async t=>{if(!confirm(`Delete ${t.length} dealer(s)?`))return;const s=x;p(i=>i.filter(c=>!t.includes(c.id)));try{t.length===1?await u.del(`/dealers/${t[0]}`):await u.post("/dealers/bulk-delete",{ids:t})}catch{p(s),alert("Failed to delete")}},U=()=>{const t=["Organization","Primary Contact","Region","Status","Users","Last"],s=I.map(n=>[n.org,`${n.contactName} <${n.contactEmail}>`,n.region,n.status,String(n.users),n.last]),i=[t,...s].map(n=>n.map(m=>'"'+String(m).replace(/"/g,'""')+'"').join(",")).join(`
`),c=new Blob([i],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(c),g=document.createElement("a");g.href=h,g.download="dealers.csv",g.click(),URL.revokeObjectURL(h)},O=[{key:"select",header:"",render:t=>e.jsx("input",{type:"checkbox",checked:R.includes(t.id),onChange:s=>F(i=>s.target.checked?[...i,t.id]:i.filter(c=>c!==t.id))})},...[{key:"org",header:"Organization"},{key:"contact",header:"Primary Contact",render:t=>`${t.contactName} <${t.contactEmail}>`},{key:"region",header:"Region"},{key:"status",header:"Status",render:t=>e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),B(i=>i===t.id?null:t.id)},style:{padding:"4px 8px",borderRadius:999,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:e.jsx(D,{status:t.status})}),z===t.id&&e.jsx("div",{style:{position:"absolute",top:"110%",left:0,background:"#0E1621",border:"1px solid #223",borderRadius:8,padding:6,display:"grid",gap:4,zIndex:10},children:["Pending","Active","Suspended"].map(s=>e.jsx("button",{onClick:i=>{i.stopPropagation(),P(t.id,s),B(null)},style:{textAlign:"left",padding:"6px 8px",borderRadius:6,border:"1px solid #233140",background:t.status===s?"#132030":"#0B1117",color:"#E6E6E6"},children:s},s))})]})},{key:"users",header:"Users(#)"},{key:"last",header:"Last Activity"},{key:"actions",header:"",render:t=>e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),S(t),E(!0)},style:{padding:"4px 8px",border:"1px solid #334",borderRadius:8},children:"Edit"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),k([t.id])},style:{padding:"4px 8px",border:"1px solid #334",borderRadius:8},children:"Delete"})]})}]],$=e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"end",flexWrap:"wrap"},children:[e.jsx(q,{label:"Search",value:d,onChange:t=>b(t.target.value),placeholder:"Org, contact, email, region"}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:12,color:"#C5C6C7"},children:"Status"}),e.jsxs("select",{value:o,onChange:t=>f(t.target.value||""),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"Active"}),e.jsx("option",{children:"Suspended"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:12,color:"#C5C6C7"},children:"Region"}),e.jsxs("select",{value:a,onChange:t=>v(t.target.value),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{children:"NA"}),e.jsx("option",{children:"EU"}),e.jsx("option",{children:"APAC"}),e.jsx("option",{children:"ME"}),e.jsx("option",{children:"LATAM"})]})]}),e.jsx(j,{onClick:()=>C(!0),children:"Invite Dealer"}),e.jsx(j,{onClick:U,variant:"secondary",children:"Export CSV"}),e.jsx(j,{onClick:()=>k(R),variant:"ghost",children:"Delete"})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("h1",{children:"Dealers"}),e.jsx(M,{columns:O,rows:I,density:"compact",toolbar:$,onRowClick:async t=>{S(t),E(!0),w("");try{const s=await u.get(`/dealers/${t.id}/detail`);w((s==null?void 0:s.phone)||"")}catch{}}}),e.jsx(G,{open:N,onClose:()=>E(!1),title:r?r.org:"Dealer",children:r&&e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx(D,{status:r.status}),e.jsx("span",{children:r.region})]}),e.jsxs("div",{children:["Primary: ",r.contactName," <",r.contactEmail,">"]}),A&&e.jsxs("div",{children:["Phone: ",A]}),e.jsxs("div",{children:["Users: ",r.users]}),e.jsx("div",{children:"Files Shared: 0"}),e.jsx("hr",{style:{borderColor:"#223"}}),e.jsxs("label",{children:["Status",e.jsxs("select",{value:r.status,onChange:t=>P(r.id,t.target.value),style:{marginLeft:8},children:[e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"Active"}),e.jsx("option",{children:"Suspended"})]})]}),e.jsx("strong",{children:"Users"}),e.jsx("div",{style:{border:"1px solid #223",borderRadius:8,padding:8},children:"Sub-table stub"}),e.jsx("strong",{children:"Notes"}),e.jsx("ul",{children:e.jsxs("li",{children:["Created â€¢ ",r.last]})}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(j,{variant:"ghost",onClick:()=>k([r.id]),children:"Delete"})})]})}),L&&e.jsx(K,{onClose:()=>C(!1),onCreate:async t=>{try{const s=await u.post("/dealers",{org:t.org,contactName:t.contactName,email:t.email,region:t.region});p(i=>[s,...i]),alert(t.sendEmail?"Invite sent via email":"Dealer created")}catch{alert("Failed to create dealer")}finally{C(!1)}}})]})}const J=V({org:y().min(1,"Organization is required"),contactName:y().min(1,"Contact name is required"),email:y().email("Invalid email"),region:y().min(1,"Region is required"),sendEmail:Q().optional()});function K({onClose:d,onCreate:b}){const{register:o,handleSubmit:f,formState:{errors:a,isSubmitting:v}}=T({resolver:W(J)}),x=p=>b(p);return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"grid",placeItems:"center",zIndex:60},children:e.jsxs("form",{onSubmit:f(x),style:{background:"#0E1621",border:"1px solid #223",borderRadius:12,width:560,maxWidth:"96vw",padding:16,display:"grid",gap:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:"Invite Dealer"}),e.jsx("button",{type:"button",onClick:d,style:{background:"transparent",border:"1px solid #334",borderRadius:8,color:"#C5C6C7",padding:"6px 10px"},children:"Close"})]}),e.jsxs("label",{children:["Organization",e.jsx("input",{...o("org"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid "+(a.org?"#AA2E2E":"#334"),background:"#0B1117",color:"#E6E6E6"}}),a.org&&e.jsx("div",{style:{color:"#FF6B6B",fontSize:12},children:a.org.message})]}),e.jsxs("label",{children:["Contact Name",e.jsx("input",{...o("contactName"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid "+(a.contactName?"#AA2E2E":"#334"),background:"#0B1117",color:"#E6E6E6"}}),a.contactName&&e.jsx("div",{style:{color:"#FF6B6B",fontSize:12},children:a.contactName.message})]}),e.jsxs("label",{children:["Email",e.jsx("input",{type:"email",...o("email"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid "+(a.email?"#AA2E2E":"#334"),background:"#0B1117",color:"#E6E6E6"}}),a.email&&e.jsx("div",{style:{color:"#FF6B6B",fontSize:12},children:a.email.message})]}),e.jsxs("label",{children:["Region",e.jsxs("select",{...o("region"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #334",background:"#0B1117",color:"#E6E6E6"},children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"NA"}),e.jsx("option",{children:"EU"}),e.jsx("option",{children:"APAC"}),e.jsx("option",{children:"ME"}),e.jsx("option",{children:"LATAM"})]}),a.region&&e.jsx("div",{style:{color:"#FF6B6B",fontSize:12},children:a.region.message})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",...o("sendEmail")})," Send invite email"]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:d,style:{padding:"8px 12px",border:"1px solid #334",borderRadius:8},children:"Cancel"}),e.jsx("button",{disabled:v,type:"submit",style:{padding:"8px 12px",border:"1px solid #334",borderRadius:8,background:"var(--accent)",color:"#fff"},children:"Invite"})]})]})})}export{se as default};
