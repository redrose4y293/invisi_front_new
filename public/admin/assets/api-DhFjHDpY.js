function w(t){let e=(t||"").toString().trim();if(!e)return"http://localhost:8080/api/v1";e.startsWith(":")&&(e="http://localhost"+e),/^https?:\/\//i.test(e)||(e="http://"+e);try{new URL(e)}catch{return"http://localhost:8080/api/v1"}return e.replace(/\/$/,"")}const d=w("http://192.168.0.105:8080/api/v1"),y="api_access_token",T="api_refresh_token";function g(t={}){t.accessToken!==void 0&&localStorage.setItem(y,t.accessToken||""),t.refreshToken!==void 0&&localStorage.setItem(T,t.refreshToken||"")}function p(){try{return localStorage.getItem(y)||""}catch{return""}}function u(){try{return localStorage.getItem(T)||""}catch{return""}}let o=null;async function k(){return u()?(o||(o=(async()=>{try{const t=await fetch(d.replace(/\/$/,"")+"/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:u()})});if(!t.ok)return o=null,!1;const e=await t.json().catch(()=>({}));return g({accessToken:e.accessToken,refreshToken:e.refreshToken}),o=null,!0}catch{return o=null,!1}})()),o):!1}async function r(t,e={}){const n=new Headers(e.headers||{});!n.has("Content-Type")&&!(e.body instanceof FormData)&&n.set("Content-Type","application/json");const c=p();c&&n.set("Authorization",`Bearer ${c}`);const i=(d||(typeof window<"u"?`${window.location.origin}/api/v1`:"http://localhost:8080/api/v1")).replace(/\/$/,"")+"/"+t.replace(/^\//,"");let a=await fetch(i,{...e,headers:n});if(a.status===401&&await k()){const s=new Headers(e.headers||{});!s.has("Content-Type")&&!(e.body instanceof FormData)&&s.set("Content-Type","application/json");const l=p();l&&s.set("Authorization",`Bearer ${l}`),a=await fetch(i,{...e,headers:s})}const h=(a.headers.get("content-type")||"").includes("application/json");if(!a.ok){const f=h?await a.json().catch(()=>({})):await a.text().catch(()=>"");throw{status:a.status,body:f}}return h?await a.json():await a.text()}const E={get:t=>r(t,{method:"GET"}),post:(t,e)=>r(t,{method:"POST",body:e instanceof FormData?e:JSON.stringify(e)}),patch:(t,e)=>r(t,{method:"PATCH",body:JSON.stringify(e)}),del:t=>r(t,{method:"DELETE"})};export{E as a,g as s};
